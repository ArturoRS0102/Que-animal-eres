<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¿Qué Animal Eres?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            /* Agregamos padding para que los banners fijos no oculten el contenido */
            padding-top: 100px; /* Espacio para el banner superior */
            padding-bottom: 100px; /* Espacio para el banner inferior */
        }
        .ad-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            z-index: 50;
        }
        .ad-container-top {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 90px; /* Altura del banner */
            border-bottom: 1px solid #ddd;
        }
        .ad-container-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 90px; /* Altura del banner */
            border-top: 1px solid #ddd;
        }
        .opcion-seleccionada {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }
    </style>
</head>
<body class="bg-amber-50 text-gray-800">

    <!-- ===== CONTENEDOR DEL BANNER SUPERIOR ===== -->
    <div class="ad-container ad-container-top">
        <!-- Script del banner superior -->
        <script src="https://fpyf8.com/88/tag.min.js" data-zone="9575359" async data-cfasync="false"></script>
        <!-- Mensaje por si el ad no carga -->
        <span class="text-gray-500 text-sm">Espacio publicitario</span>
    </div>

    <main class="container mx-auto p-4 md:p-8 max-w-4xl">
        <div id="quiz-section" class="bg-white p-6 md:p-10 rounded-2xl shadow-lg">
            <h1 class="text-3xl md:text-4xl font-bold text-center text-amber-600 mb-2">¿Qué Animal Eres?</h1>
            <p class="text-center text-gray-600 mb-8">Responde 8 preguntas y deja que la IA descubra tu animal interior.</p>
            
            <!-- El formulario del quiz (código Jinja2 sin cambios) -->
            <form id="quiz-form">
                <!-- Aquí iría tu bucle de Jinja2 para las preguntas -->
                <!-- Ejemplo de una pregunta para que el HTML sea válido -->
                <div class="mb-8 question-block">
                  <p class="text-lg font-semibold mb-4">1. ¿Cuál es tu plan ideal para un fin de semana?</p>
                  <div class="space-y-2">
                    <div>
                      <input type="radio" id="q1-a" name="q1" value="a" required class="hidden">
                      <label for="q1-a" class="block p-4 border rounded-lg cursor-pointer hover:bg-amber-100 hover:border-amber-400 transition-colors">Salir de fiesta con amigos.</label>
                    </div>
                    <div>
                      <input type="radio" id="q1-b" name="q1" value="b" required class="hidden">
                      <label for="q1-b" class="block p-4 border rounded-lg cursor-pointer hover:bg-amber-100 hover:border-amber-400 transition-colors">Una tarde tranquila leyendo un libro.</label>
                    </div>
                  </div>
                </div>
                 <div class="mb-8 question-block">
                  <p class="text-lg font-semibold mb-4">2. ¿Cómo reaccionas ante un problema?</p>
                  <div class="space-y-2">
                    <div>
                      <input type="radio" id="q2-a" name="q2" value="a" required class="hidden">
                      <label for="q2-a" class="block p-4 border rounded-lg cursor-pointer hover:bg-amber-100 hover:border-amber-400 transition-colors">Lo analizo con calma y busco una solución lógica.</label>
                    </div>
                    <div>
                      <input type="radio" id="q2-b" name="q2" value="b" required class="hidden">
                      <label for="q2-b" class="block p-4 border rounded-lg cursor-pointer hover:bg-amber-100 hover:border-amber-400 transition-colors">Actúo por instinto y con rapidez.</label>
                    </div>
                  </div>
                </div>
                <!-- Repetir para las 8 preguntas -->

                <div class="text-center mt-8">
                    <button type="submit" class="bg-amber-500 text-white font-bold py-3 px-10 rounded-full hover:bg-amber-600 transition-transform transform hover:scale-105 shadow-md">
                        ¡Descubrir mi animal!
                    </button>
                </div>
            </form>
        </div>

        <div id="loading-section" class="hidden text-center p-10 bg-white rounded-2xl shadow-lg">
            <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-amber-500 mx-auto"></div>
            <h2 class="text-2xl font-bold mt-6 text-amber-600">Analizando tu alma salvaje...</h2>
            <p class="text-gray-600 mt-2">Un breve anuncio antes de revelar tu resultado.</p>
            <div class="mt-4 text-4xl font-bold text-amber-500" id="ad-timer">15</div>
            <!-- Banner intermedio -->
            <div class="w-full flex justify-center my-4 min-h-[100px]">
                <script src="https://fpyf8.com/88/tag.min.js" data-zone="9575358" async data-cfasync="false"></script>
            </div>
        </div>

        <div id="result-section" class="hidden text-center p-6 md:p-10 bg-white rounded-2xl shadow-lg">
            <img id="animal-image" src="https://placehold.co/300x300/f59e0b/ffffff?text=Animal" class="w-48 h-48 object-cover rounded-full mx-auto mb-6 border-4 border-amber-300 shadow-md" alt="Imagen del animal">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-600">¡Eres un <span id="animal-name">...</span>!</h2>
            <p id="animal-description" class="text-lg text-gray-700 mt-4 max-w-2xl mx-auto">...</p>
            <blockquote class="mt-6">
                <p id="animal-motto" class="text-xl italic text-gray-500">"...lema..."</p>
            </blockquote>
            <div class="mt-8">
                <p class="font-semibold mb-4">¡Comparte tu resultado!</p>
                <div class="flex justify-center space-x-4">
                    <a id="share-twitter" href="#" target="_blank" class="bg-blue-400 text-white py-2 px-4 rounded-full hover:bg-blue-500">Twitter</a>
                    <a id="share-facebook" href="#" target="_blank" class="bg-blue-800 text-white py-2 px-4 rounded-full hover:bg-blue-900">Facebook</a>
                    <button id="copy-link" class="bg-gray-500 text-white py-2 px-4 rounded-full hover:bg-gray-600">Copiar Enlace</button>
                </div>
                <p id="copy-feedback" class="text-sm text-green-600 mt-2 h-4"></p>
            </div>
            <div class="mt-8">
                <button onclick="window.location.reload()" class="bg-amber-500 text-white font-bold py-3 px-8 rounded-full hover:bg-amber-600 hover:scale-105 shadow-md">
                    Hacer el test de nuevo
                </button>
            </div>
        </div>
    </main>

    <!-- ===== CONTENEDOR DEL BANNER INFERIOR ===== -->
    <div class="ad-container ad-container-bottom">
        <!-- Puedes usar el mismo script con otra zona si la tienes, o uno diferente -->
        <script src="https://fpyf8.com/88/tag.min.js" data-zone="9575359" async data-cfasync="false"></script>
        <!-- Mensaje por si el ad no carga -->
        <span class="text-gray-500 text-sm">Espacio publicitario</span>
    </div>

    <script>
        // Registro del ServiceWorker (sin cambios)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                    console.log('ServiceWorker registrado con éxito:', registration.scope);
                })
                .catch(function(error) {
                    console.log('Error al registrar el ServiceWorker:', error);
                });
        }
    </script>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("quiz-form");
        const quizSection = document.getElementById("quiz-section");
        const loadingSection = document.getElementById("loading-section");
        const resultSection = document.getElementById("result-section");
        const copyFeedback = document.getElementById("copy-feedback");
        const copyButton = document.getElementById("copy-link");

        // Lógica para seleccionar opciones
        document.querySelectorAll(".question-block").forEach(block => {
            const radios = block.querySelectorAll("input[type='radio']");
            radios.forEach(radio => {
                radio.addEventListener("change", () => {
                    // Quita la clase de todas las etiquetas en este bloque
                    block.querySelectorAll("label").forEach(label => {
                        label.classList.remove("opcion-seleccionada");
                    });
                    // Añade la clase a la etiqueta seleccionada
                    const selectedLabel = block.querySelector(`label[for="${radio.id}"]`);
                    if (selectedLabel) selectedLabel.classList.add("opcion-seleccionada");
                });
            });
        });

        // Envío del formulario
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            quizSection.classList.add("hidden");
            loadingSection.classList.remove("hidden");

            const respuestas = {};
            const totalQuestions = document.querySelectorAll('.question-block').length;
            // Asumiendo que los nombres son q1, q2, etc.
            for (let i = 1; i <= totalQuestions; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected) {
                    respuestas[`q${i}`] = selected.value;
                }
            }

            // Temporizador para el anuncio
            let seconds = 15;
            const timer = document.getElementById("ad-timer");
            timer.textContent = seconds;
            const countdown = setInterval(() => {
                seconds--;
                timer.textContent = seconds;
                if (seconds <= 0) {
                    clearInterval(countdown);
                    // Llama a una función de ejemplo, ya que no tenemos el backend
                    mostrarResultadoDeEjemplo(); 
                }
            }, 1000);
        });
        
        // Función de ejemplo para mostrar resultados sin un backend real
        function mostrarResultadoDeEjemplo() {
            const data = {
                animal: "Lobo",
                descripcion: "Eres un líder nato, valoras la manada y tienes un fuerte sentido de la lealtad. Te mueves con confianza y no temes enfrentarte a los desafíos.",
                lema: "La fuerza de la manada es el lobo, y la fuerza del lobo es la manada.",
                imagen: "https://source.unsplash.com/300x300/?wolf"
            };

            loadingSection.classList.add("hidden");
            resultSection.classList.remove("hidden");
            
            document.getElementById("animal-name").textContent = data.animal;
            document.getElementById("animal-description").textContent = data.descripcion;
            document.getElementById("animal-motto").textContent = `"${data.lema}"`;
            document.getElementById("animal-image").src = data.imagen;
            document.getElementById("animal-image").alt = `Imagen de un ${data.animal}`;

            const currentURL = window.location.href;
            const shareText = `¡En el test descubrí que soy un ${data.animal}! ¿Y tú?`;
            
            document.getElementById("share-twitter").href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(currentURL)}`;
            document.getElementById("share-facebook").href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentURL)}`;
        }

        // Lógica para copiar enlace (más compatible)
        copyButton.onclick = () => {
            const urlToCopy = window.location.href;
            const textArea = document.createElement("textarea");
            textArea.value = urlToCopy;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                copyFeedback.textContent = "¡Enlace copiado!";
            } catch (err) {
                copyFeedback.textContent = "Error al copiar";
                console.error('Error al copiar el enlace: ', err);
            }
            document.body.removeChild(textArea);
            setTimeout(() => {
                copyFeedback.textContent = "";
            }, 3000);
        };
    });
    </script>

</body>
</html>